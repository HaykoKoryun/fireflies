!function(a,t){"function"==typeof define&&define.amd?define([],t):a.fireflies=t()}(this,function(){function a(){return.001+.029*Math.random()}function t(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,t,r,n){return t+t+r+r+n+n});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}return function(r){var n=this,o=r.canvas;o.width=o.clientWidth,o.height=o.clientHeight;var d=o.getContext("2d"),e=(r.damp,r.population||10),i=r.foci||[],h=r.bound||25,y=r.minRadius||2,u=r.maxRadius||7,c=void 0!==r.minOpacity?r.minOpacity:.3,f=r.maxOpacity||1,x=r.color||"#ffffff";if(null===(x=t(x)))throw"Invaid color: "+r.color;x="rgba("+x.r+","+x.g+","+x.b+",";for(var m,l=[],p=0;p<e;++p){var v={x:h+Math.random()*(o.width-2*h),y:h+Math.random()*(o.height-2*h),vx:Math.random()-.5,vy:Math.random()-.5,re_boundx:!1,re_boundy:!1,radius:y+Math.random()*(u-y),opacity:c+Math.random()*(f-c),opacityD:a()};l.push(v)}n.render=function(){d.clearRect(0,0,o.width,o.height);for(var t=0;t<l.length;++t){var e=l[t];e.re_boundx||(Math.random()>98?e.vx=Math.random()-.5:e.vx+=.5*Math.random()-.25),e.re_boundy||(Math.random()>98?e.vy=Math.random()-.5:e.vy+=.5*Math.random()-.25),e.re_boundx||(e.vx*=.11*Math.random()+.9),e.re_boundy||(e.vy*=.11*Math.random()+.9);var y=20*Math.random()+5;if(!e.re_boundx&&(e.x<y||e.x>o.width-y)&&(e.re_boundx=!0,e.vx=.5*Math.random()*(e.x<y?1:-1)),e.x>h&&e.x<o.width-h&&e.re_boundx&&(e.re_boundx=!1),!e.re_boundy&&(e.y<y||e.y>o.height-y)&&(e.re_boundy=!0,e.vy=.5*Math.random()*(e.y<y?1:-1)),e.y>h&&e.y<o.height-h&&e.re_boundy&&(e.re_boundy=!1),e.x+=e.vx,e.y+=e.vy,i.length>0){var u=i[Math.round(Math.random()*(i.length-1))],c={x:u.x,y:u.y},f=c.x-e.x,p=c.y-e.y;f*=u.gravity,p*=u.gravity,e.x+=f,e.y+=p}d.beginPath(),d.arc(e.x,e.y,e.radius,0,2*Math.PI),d.closePath(),e.opacity+=e.opacityD,e.opacity<0?(e.opacity=0,e.opacityD=a()):e.opacity>1&&(e.opacity=1,e.opacityD=a()*-1),m=d.createRadialGradient(e.x,e.y,0,e.x,e.y,e.radius*e.opacity),m.addColorStop(0,x+.6+")"),m.addColorStop(.3,x+.3+")"),m.addColorStop(1,x+"0)"),d.fillStyle=m,d.fill()}r.autoRender&&requestAnimationFrame(n.render)},r.autoRender&&requestAnimationFrame(n.render)}});